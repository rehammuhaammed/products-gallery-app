<!-- Container -->
@if (error()) {
  <div class="flex flex-col items-center justify-center py-24 text-center text-[#7c2d12]">
    <h2 class="text-2xl sm:text-3xl font-bold mb-2">Oops! Something went wrong</h2>

    <p class="text-gray-500 text-sm mb-4 max-w-md">
      {{ 'An unexpected error occurred while loading the content. Please try again later.' }}
    </p>

    <button
      (click)="reloadPage()"
      class=" cursor-pointer px-5 py-2 rounded-xl bg-[#be8c62] text-white hover:bg-[#a9764f] transition"
    >
      Try Again
    </button>
  </div>
}@else {
  <div class="max-w-7xl text-[#7c4947] mx-auto px-4 py-10 grid grid-cols-1 md:grid-cols-2 gap-10 dark:text-[#f9fbfc]  ">

  <!-- Product Images -->
  <div>
    <img 
    #modalImage
      (click)="openModal(productDetails.image)" 
      data-modal-target="popup-modal" 
      data-modal-toggle="popup-modal"  
      [src]="productDetails.image" 
      alt="Main Product Image"
      class="w-full cursor-pointer h-[600px] object-contain rounded-xl shadow-md border shadow-[#edbfbd] border-gray-200" 
    />
    
  </div>

  <!-- Product Details -->
  <div class="flex flex-col md:py-16 sm:py-6 gap-8">

    <!-- Name + Price -->
    <div>
      <h1 class="text-3xl font-bold mb-3">{{ productDetails.title }}</h1>
      <p class="text-2xl font-semibold mb-3">
        {{ productDetails.price }} {{ 'product.priceUnit' | translate }}
      </p>

      <!-- Rating -->
      @if(productDetails.rating?.rate){
        <div class="flex items-center gap-1">
        <p class="text-sm">{{ productDetails.rating.rate }}</p>
        @for (star of [1, 2, 3, 4, 5]; let i = $index; track $index) {
          @if (i < Math.floor(productDetails.rating.rate)) {
            <i class="fas fa-star text-[#f8d17c]"></i>
          } @else if (i === Math.floor(productDetails.rating.rate) && (productDetails.rating.rate % 1) >= 0.2) {
            <i class="fas fa-star-half-alt text-[#f8d17c]"></i>
          } @else {
            <i class="far fa-star text-gray-300"></i>
          }
        }
      </div>
      }
    </div>

    <!-- Description -->
    <div>
      <h2 class="text-lg font-semibold mb-1">{{ 'product.description' | translate }}</h2>
      <p class="leading-relaxed font-medium">{{ productDetails.description }}</p>
    </div>

    <!-- Add to Cart Button -->
    <button 
      (click)="addToCart(productDetails)" 
      class="mt-4 flex items-center gap-2 uppercase w-fit bg-buttonbg text-white px-6 py-2 rounded-lg hover:bg-mainColor/90 hover:scale-105 cursor-pointer transition-all duration-300"
    >
    <i class="fas fa-cart-plus"></i>
      {{ 'product.addToCart' | translate }}
    </button>

   

    <!-- Category -->
    <p class="text-sm">
      {{ 'product.category' | translate }}:
      <span class="font-medium">{{ productDetails.category }}</span>
    </p>

   
  </div>



</div>

<!-- Modal for image preview -->
<app-modal [current_Img]="currentimg"></app-modal>

<!-- Related Products -->
  <section class="max-w-7xl mx-auto mt-20  ">
    <h2 #el class="text-3xl  font-bold mb-4 text-maintext ">{{ 'product.Related Products' | translate }}</h2>
  </section>

@defer ( on viewport(el) ) {
    <section class="max-w-7xl mx-auto  mb-16 ">
  

  <div class="grid sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
    <!-- Product Card -->
   @for (item of relatedProducts; track item.id) {
     <div [routerLink]="['/details', item.id]" class="bg-mainBg text-maintext rounded-xl shadow-md overflow-hidden hover:shadow-lg transition-all duration-300 cursor-pointer dark:bg-[#ceb991]  dark:text-[#f9fbfc]">
      <img [src]="item.image" alt="Product Image" class="w-full h-60 object-contain" />
      <div class="p-4">
        <h3 class="text-md font-semibold mb-1">{{item.title.split(' ').slice(0,3).join(' ') }}</h3>
        <div class="flex justify-between items-center text-sm">
          <span>{{item.price}} EGP</span>
          <div class="flex items-center gap-1">
            <i class="fas fa-star text-yellow-400 text-xs"></i>
            <span>{{item.rating.rate}}</span>
          </div>
        </div>
      </div>
    </div>
   }


  </div>
</section>
}

}